<!doctype html>
<html lang="zh-cn" data-theme="hsuan">
<head>
	<meta charset="utf-8" />
	<link rel="icon" href="../favicon/default.png" type="image/png" />
	<meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0" />
	<meta name="google-site-verification" content="7z3kFWsiELnfEkWYFIbxk5fDUCI8EBFQar82cE_jt_8" />
	<!-- <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"/ > -->
	<title>Hsuan's Space</title>
	
		<link href="../_app/immutable/assets/0.B9bD--0z.css" rel="stylesheet">
		<link rel="modulepreload" href="../_app/immutable/entry/start.CivIbf2k.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/CpJ_zQkh.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/Dn7kmhKU.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/55DTsrXR.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/cJOcSlm5.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/CYgJF_JY.js">
		<link rel="modulepreload" href="../_app/immutable/entry/app.BtJwDL0j.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/Dp1pzeXC.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/CWj6FrbW.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/Bxg84u-P.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/0V-weUyZ.js">
		<link rel="modulepreload" href="../_app/immutable/nodes/0.BeAvjcT8.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/BheWnx7M.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/PB-FJpp_.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/PD1Wq3xD.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/Dv3sjCI-.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/2LSbsVY0.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/1n_NDudY.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/DvpkVvb5.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/TAnICSW8.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/wklvEFpS.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/BEYSVr-f.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/BGGTUj09.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/DaUhtoAx.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/BMnMWXzj.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/Dw-omCbI.js">
		<link rel="modulepreload" href="../_app/immutable/nodes/5.BeHWQH2e.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/DK3p7Ma_.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/BoVWJXks.js"><!--[--><meta name="description" content="Welcome to Hsuan's personal space - A collection of thoughts, experiences, and creative works by Xuancong Meng."> <meta name="viewport" content="width=device-width, initial-scale=1"> <meta name="robots" content="index, follow"> <meta property="og:title" content="Hsuan's Space"> <meta property="og:description" content="A collection of thoughts, experiences, and creative works by Xuancong Meng."> <meta property="og:type" content="website"> <link rel="alternate" type="application/rss+xml" title="RSS Feed for Hsuan's Space" href="/feed/rss.xml"> <link rel="alternate" type="application/atom+xml" title="Atom Feed for Hsuan's Space" href="/feed/atom.xml"> <link rel="alternate" type="application/json" title="JSON Feed for Hsuan's Space" href="/feed/feed.json"><!--]--><!--[--><script>
		(function() {
			const savedTheme = sessionStorage.getItem('theme-mode');
			const isDark = savedTheme ? savedTheme === 'dark' : window.matchMedia('(prefers-color-scheme: dark)').matches;
			document.documentElement.setAttribute('data-mode', isDark ? 'dark' : 'light');
		})();
	</script><!----><!--]--><!--[--><meta name="description" content="深入,解析, svelte-text-animation ,组件,的,技术,实现,与,最,新,优化 - Xuancong Meng"> <meta name="author" content="Xuancong Meng"> <meta name="keywords" content="Technique, Web"> <meta property="og:title" content="TextAnimation 的实现细节 - Hsuan's Blog"> <meta property="og:description" content="深入解析 svelte-text-animation 组件的技术实现与最新优化"> <meta property="og:type" content="article"> <meta property="article:author" content="Xuancong Meng"> <meta property="article:published_time" content="2025-07-21T12:44:11.000Z"> <meta property="article:tag" content="Technique, Web"><!--]--><title>TextAnimation 的实现细节 - Hsuan's Blog</title>
</head>
<body data-sveltekit-preload-data="hover">
<div class="sveltekit-body"><!--[--><!--[--><!----><div class="main min-h-[100vh] flex flex-col relative snap-end"><div class="header relative px-[20px] py-1.5 md:py-3 svelte-1bz59og" style="--noise-size: 50px;"><div class="svelte-1bz59og"><div class="grow flex items-end gap-1 md:gap-4"><a href="/" class="hidden sm:block scale-75 md:scale-100"><svg class="h-[30px] w-[40px]" style="transform: scale(1.2)" width="58" height="44" viewBox="0 0 58 44" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M0.618652 41.6084C1.50667 41.6084 2.25342 41.5781 2.85889 41.5176C3.48454 41.4368 4.00928 41.3258 4.43311 41.1846C4.85693 41.0231 5.21012 40.8213 5.49268 40.5791C5.77523 40.3369 6.01742 40.0544 6.21924 39.7314L17.63 21.66L27.925 5.35916L26.794 3.46387L6.76102 3.46387L1.95068 3.46387V1.10254H34.5854V3.46387H29.7417L38.7026 18.4795L47.2095 5.25C47.27 5.16927 47.3003 5.03809 47.3003 4.85645C47.3003 4.59408 47.159 4.38216 46.8765 4.2207C46.6141 4.03906 46.2407 3.89779 45.7563 3.79688C45.272 3.67578 44.6867 3.59505 44.0005 3.55469C43.3345 3.49414 42.5978 3.46387 41.7905 3.46387V1.10254H55.8979V3.46387C55.0099 3.46387 54.2531 3.50423 53.6274 3.58496C53.0018 3.66569 52.4771 3.78678 52.0532 3.94824C51.6294 4.08952 51.2762 4.28125 50.9937 4.52344C50.7313 4.74544 50.4992 5.0179 50.2974 5.34082L40.3071 21.1738L52.5376 41.6084H57.3813V44H24.7466V41.6084H29.5601L19.2368 24.3525L9.27686 39.8828C9.21631 39.9837 9.18604 40.0947 9.18604 40.2158C9.18604 40.4984 9.31722 40.7305 9.57959 40.9121C9.86214 41.0736 10.2456 41.2148 10.73 41.3359C11.2345 41.4368 11.8198 41.5075 12.4858 41.5479C13.172 41.5882 13.9188 41.6084 14.7261 41.6084V44H0.618652V41.6084Z" fill="currentColor"></path><path d="M27.925 5.35916L26.794 3.46387L6.76102 3.46387L17.63 21.66L27.925 5.35916Z" fill="currentColor" fill-opacity="0.8"></path><!--[--><path d="M11.7642 3.46387L15.7642 3.46387L38.5312 41.61L34.5312 41.61Z" fill="#309898"></path><path d="M15.7642 3.46387L19.7642 3.46387L42.5312 41.61L38.5312 41.61Z" fill="#FE9F0D"></path><path d="M19.7642 3.46387L23.7642 3.46387L46.5313 41.61L42.5312 41.61Z" fill="#F4631E"></path><path d="M23.7642 3.46387L26.794 3.46387L49.5586 41.61L46.5312 41.61Z" fill="#D92E10"></path><!--]--></svg><!----></a> <!--[!--><div class="flex gap-1"><!--[--><a href="/" class="link h6 leading-4 hover:text-primary-700-300   svelte-1bz59og">Blog Space</a><a href="/about" class="link h6 leading-4 hover:text-secondary-700-300   svelte-1bz59og">About Me</a><!--]--></div><!--]--></div> <div class="flex h-[26.88px] items-center sm:gap-4 sm:flex"><!--[--><div class="flex h-full"><a class="group chip text-surface-contrast-50-950 bg-background h-full rounded-full hidden sm:inline-flex svelte-164k0ge" href="https://www.travellings.cn/go.html" target="_blank" rel="noopener" title="开往-友链接力"><div class="icons svelte-164k0ge"><div class="logo svelte-164k0ge"><!--[!--><!--]--><!----></div> <div class="arrow svelte-164k0ge"><!--[!--><!--]--><!----></div></div> <span class="desc-wrapper pointer-events-none svelte-164k0ge"><div class="desc svelte-164k0ge">Travelling</div></span></a><!----></div><!--]--> <div class="flex items-center gap-2 rounded-full hidden sm:inline-flex" style="opacity: 0"><!--#s1--><label data-scope="switch" data-part="root" data-state="unchecked" id="switch:s1" for="switch:s1:input" class="inline-flex items-center gap-4 " data-testid="switch"><input id="switch:s1:input" type="checkbox" aria-labelledby="switch:s1:label" name="mode" value="on" style="border:0;clip:rect(0 0 0 0);height:1px;margin:-1px;overflow:hidden;padding:0;position:absolute;width:1px;white-space:nowrap;word-wrap:normal;" data-testid="switch-input"> <span data-scope="switch" data-part="control" data-state="unchecked" id="switch:s1:control" aria-hidden="true" class="cursor-pointer transition duration-200 preset-filled-surface-200-800  w-10 h-6 p-0.5 rounded-full hover:brightness-90 dark:hover:brightness-110  bg-surface-950/30" data-testid="switch-control"><span data-scope="switch" data-part="thumb" data-state="unchecked" id="switch:s1:thumb" aria-hidden="true" class="right-0 aspect-square h-full flex justify-center items-center text-right cursor-pointer preset-filled-surface-50-950 rounded-full transition ease-in-out duration-200 bg-background" data-testid="switch-thumb"><!--[--><span class="pointer-events-none" data-testid="switch-icon-inactive"><!--[!--><!--]--><!----></span><!--]--> <!--[!--><!--]--></span></span> <!--[!--><!--]--></label><!----></div><!----> <!--#s2--><span class=" h-4/5 flex sm:hidden" data-testid="popover"><!--[--><button data-scope="popover" data-part="trigger" type="button" id="popover:s2:trigger" aria-haspopup="dialog" data-state="closed" aria-controls="popover:s2:content" class="btn px-2 hover:preset-tonal  " aria-label=""><!--[!--><!--]--><!----></button><!--]--> <div id="popover:s2:popper" data-scope="popover" data-part="positioner" style="position:absolute;isolation:isolate;min-width:max-content;pointer-events:none;top:0px;left:0px;transform:translate3d(0, -100vh, 0);z-index:var(--z-index);" class=" "><!--[!--><!--]--></div></span><!----></div></div></div><!----> <div class="flex-1 flex flex-col items-center justify-center py-5"><!----><!----><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous"> <article class="prose lg:prose-xl my-4 w-[80%]"><header class="mb-10"><h1 class="mb-2"><!--[--><span style="word-break: keep-all; overflow-wrap: anywhere;" class="">TextAnimation </span><span style="word-break: keep-all; overflow-wrap: anywhere;" class="">的</span><span style="word-break: keep-all; overflow-wrap: anywhere;" class="">实现</span><span style="word-break: keep-all; overflow-wrap: anywhere;" class="">细节</span><!--]--><!----></h1> <div class="font-noto-sans text-sm lg:text-base opacity-70"><!--[--><span style="word-break: keep-all; overflow-wrap: anywhere;" class="">深入</span><span style="word-break: keep-all; overflow-wrap: anywhere;" class="">解析</span><span style="word-break: keep-all; overflow-wrap: anywhere;" class=""> svelte-text-animation </span><span style="word-break: keep-all; overflow-wrap: anywhere;" class="">组件</span><span style="word-break: keep-all; overflow-wrap: anywhere;" class="">的</span><span style="word-break: keep-all; overflow-wrap: anywhere;" class="">技术</span><span style="word-break: keep-all; overflow-wrap: anywhere;" class="">实现</span><span style="word-break: keep-all; overflow-wrap: anywhere;" class="">与</span><span style="word-break: keep-all; overflow-wrap: anywhere;" class="">最</span><span style="word-break: keep-all; overflow-wrap: anywhere;" class="">新</span><span style="word-break: keep-all; overflow-wrap: anywhere;" class="">优化</span><!--]--><!----></div> <div class="flex justify-between my-4"><!--[--><div class="flex items-center gap-2"><!--[--><div class="bg-secondary-500/40 text-secondary-950-50 text-sm font-caveat rounded px-2 whitespace-nowrap">Technique</div><div class="bg-secondary-500/40 text-secondary-950-50 text-sm font-caveat rounded px-2 whitespace-nowrap">Web</div><!--]--></div><!--]--><!----> <div class="flex gap-4 font-[Georgia] oldstyle-nums text-sm lg:text-base opacity-80">Xuancong Meng <time datetime="Mon Jul 21 2025 12:44:11 GMT+0000 (Coordinated Universal Time)">7/21/2025</time></div></div> <hr class="mt-4 mb-0"></header> <div class="mb-10"><p>在<a href="./250525-tech-stack-in-hsuans-space">之前的文章</a>中，我简单提到了自己开发的 <a href="https://github.com/QuarkPixel/svelte-text-animationplaceholder" rel="nofollow"><code>svelte-text-animation</code></a> 组件。这个组件最初是为了本站首页 Landing 部分的文字动画效果而设计的，后来觉得特别好用就抽象成了一个独立的组件。最近对组件进行了一些优化更新，借此机会来详细介绍一下这个库的实现细节。</p> <h2 id="核心设计思路"><a class="anchor-link" href="#核心设计思路">核心设计思路</a></h2> <h3 id="基本原理"><a class="anchor-link" href="#基本原理">基本原理</a></h3> <p>整个动画的核心思想非常简洁：<strong>使用高斯函数叠加边缘递减函数</strong>，为文本中的每个字符计算一个效果强度值，然后通过回调函数将这个强度转换为具体的样式。</p> <p><img src="https://raw.githubusercontent.com/QuarkPixel/svelte-text-animation/master/assets/example.gif" alt="Demo"></p> <h3 id="数学模型"><a class="anchor-link" href="#数学模型">数学模型</a></h3> <p>动画效果由两个关键函数组成：</p> <ol><li><strong>高斯函数</strong>：控制效果在文本中的空间分布</li> <li><strong>边缘递减函数</strong>：确保动画在起始和结束时平滑过渡</li></ol> <h2 id="最新优化更平缓的边缘递减函数"><a class="anchor-link" href="#最新优化更平缓的边缘递减函数">最新优化：更平缓的边缘递减函数</a></h2> <h3 id="原有实现的局限性"><a class="anchor-link" href="#原有实现的局限性">原有实现的局限性</a></h3> <p>在之前的版本中，边缘递减函数使用的是简单的二次函数：</p> <div class="math math-display"><!----><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>f</mi><mtext>old</mtext></msub><mo stretchy="false">(</mo><mi>p</mi><mo stretchy="false">)</mo><mo>=</mo><mn>4</mn><mi>p</mi><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><mi>p</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">f_{\text{old}}(p) = 4p(1 - p)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">old</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">p</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">4</span><span class="mord mathnormal">p</span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">p</span><span class="mclose">)</span></span></span></span></span><!----></div> <p>其中 <span class="math math-inline"><!----><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span></span></span></span><!----></span> 表示动画进度（progress）。这个函数确实能够满足边界条件：在 <span class="math math-inline"><!----><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">p = 0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span></span></span><!----></span> 和 <span class="math math-inline"><!----><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">p = 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span><!----></span> 时函数值为 0，在 <span class="math math-inline"><!----><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mo>=</mo><mn>0.5</mn></mrow><annotation encoding="application/x-tex">p = 0.5</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0.5</span></span></span></span><!----></span> 时达到最大值 <span class="math math-inline"><!----><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span><!----></span>，实现了平滑过渡的目标。</p> <p>然而，这种实现存在一个显著问题：<strong>动画效果仅在进度接近 0.5 时才能完全展现，其他位置的效果都会被显著削弱</strong>。这意味着动画的大部分时间里，文字效果都无法达到理想状态。</p> <h3 id="新的数学方案"><a class="anchor-link" href="#新的数学方案">新的数学方案</a></h3> <p>经过深入思考和数学推导，我设计了一个更高阶的多项式函数：</p> <div class="math math-display"><!----><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>f</mi><mtext>new</mtext></msub><mo stretchy="false">(</mo><mi>p</mi><mo stretchy="false">)</mo><mo>=</mo><mn>1</mn><mo>−</mo><mo stretchy="false">(</mo><mn>2</mn><mi>p</mi><mo>−</mo><mn>1</mn><msup><mo stretchy="false">)</mo><mrow><mn>2</mn><mi>n</mi></mrow></msup></mrow><annotation encoding="application/x-tex">f_{\text{new}}(p) = 1 - (2p - 1)^{2n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">new</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">p</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">2</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.1141em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span></span></span></span></span></span><!----></div> <p>其中 <span class="math math-inline"><!----><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span><!----></span> 对应新增的 <code>edgeFlatness</code> 参数（默认值为 5），用于控制函数的平缓程度。</p> <p>这个改进后的函数具有以下优秀特性：</p> <ul><li><strong>保持边界条件</strong>：当 <span class="math math-inline"><!----><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">p = 0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span></span></span><!----></span> 或 <span class="math math-inline"><!----><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">p = 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span><!----></span> 时，函数值依然为 <span class="math math-inline"><!----><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span></span></span><!----></span></li> <li><strong>峰值位置不变</strong>：在 <span class="math math-inline"><!----><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mo>=</mo><mn>0.5</mn></mrow><annotation encoding="application/x-tex">p = 0.5</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0.5</span></span></span></span><!----></span> 时函数值仍为 <span class="math math-inline"><!----><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span><!----></span></li> <li><strong>中间区域显著改善</strong>：通过调整 <span class="math math-inline"><!----><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span><!----></span> 参数，可以让更大范围内的进度值都接近最大效果强度</li></ul> <h3 id="函数特性分析"><a class="anchor-link" href="#函数特性分析">函数特性分析</a></h3> <p>通过数学分析可以发现，当 <span class="math math-inline"><!----><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">n = 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span><!----></span> 时，新函数退化为原有的二次函数。而当 <span class="math math-inline"><!----><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>&gt;</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">n &gt; 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span><!----></span> 时，函数变为 <span class="math math-inline"><!----><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn><mi>n</mi></mrow><annotation encoding="application/x-tex">2n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span><span class="mord mathnormal">n</span></span></span></span><!----></span> 次多项式，相当于在原有基础上增加了一个可调节的平缓度参数。</p> <center><img class="outline outline-[#26796D] outline-3 w-[50%]" src="/assets/20250721-0.gif" alt="edgeFactor 函数演示"> <em>不同 flatness 值下的边缘递减函数对比</em></center> <p>从图中可以直观看出，随着 <code>flatness</code> 参数的增大，函数在中间区域变得更加平缓，这意味着动画效果在更大的进度范围内都能保持接近最大强度，显著提升了整体的视觉表现。</p> <h2 id="核心实现解析"><a class="anchor-link" href="#核心实现解析">核心实现解析</a></h2> <h3 id="效果强度数组生成算法"><a class="anchor-link" href="#效果强度数组生成算法">效果强度数组生成算法</a></h3> <pre class="language-typescript"><!----><code class="language-typescript"><span class="token keyword">function</span> <span class="token function">generateEffectArray</span><span class="token punctuation">(</span>
	length<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span>
	progress<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span>
	spread<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span>
	flatness<span class="token operator">:</span> <span class="token builtin">number</span>
<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">&#123;</span>
	<span class="token comment">// 计算边缘递减因子</span>
	<span class="token keyword">const</span> edgeFactor <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">-</span> Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> progress <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> flatness<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token builtin">Array</span></span><span class="token punctuation">(</span>length<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// 早期返回优化：当边缘因子为负时直接返回零数组</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>edgeFactor <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">return</span> result<span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>

	<span class="token comment">// 计算当前动画焦点在文本中的位置</span>
	<span class="token keyword">const</span> offset <span class="token operator">=</span> progress <span class="token operator">*</span> <span class="token punctuation">(</span>length <span class="token operator">+</span> <span class="token number">2</span> <span class="token operator">*</span> spread <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">-</span> spread <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>

	<span class="token comment">// 优化计算范围，避免不必要的高斯函数计算</span>
	<span class="token keyword">const</span> startIdx <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>offset <span class="token operator">-</span> spread <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">const</span> endIdx <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token function">ceil</span><span class="token punctuation">(</span>offset <span class="token operator">+</span> spread <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> startIdx<span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> endIdx<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">const</span> z <span class="token operator">=</span> <span class="token punctuation">(</span>i <span class="token operator">-</span> offset<span class="token punctuation">)</span> <span class="token operator">/</span> spread<span class="token punctuation">;</span>
		<span class="token keyword">const</span> zSquared <span class="token operator">=</span> z <span class="token operator">*</span> z<span class="token punctuation">;</span>

		<span class="token comment">// 性能优化：当 z² > 9 时，e^(-z²) &lt; 0.01，可以忽略</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>zSquared <span class="token operator">&lt;</span> <span class="token number">9</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
			result<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">exp</span><span class="token punctuation">(</span><span class="token operator">-</span>zSquared<span class="token punctuation">)</span> <span class="token operator">*</span> edgeFactor<span class="token punctuation">;</span>
		<span class="token punctuation">&#125;</span>
	<span class="token punctuation">&#125;</span>

	<span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code><!----></pre> <h3 id="关键优化策略"><a class="anchor-link" href="#关键优化策略">关键优化策略</a></h3> <ol><li><strong>早期返回优化</strong>：当边缘因子小于等于 0 时，直接返回零数组，避免后续无意义的计算</li> <li><strong>智能范围限制</strong>：仅对可能产生显著效果的字符范围进行计算，大幅降低计算复杂度</li> <li><strong>高斯函数截断</strong>：利用指数函数的快速衰减特性，当距离过远时直接跳过计算</li></ol> <h2 id="api-设计"><a class="anchor-link" href="#api-设计">API 设计</a></h2> <h3 id="核心参数接口"><a class="anchor-link" href="#核心参数接口">核心参数接口</a></h3> <pre class="language-typescript"><!----><code class="language-typescript"><span class="token keyword">interface</span> <span class="token class-name">Props</span> <span class="token punctuation">&#123;</span>
	text<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>                                 <span class="token comment">// 要进行动画的文本内容</span>
	progress<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>                             <span class="token comment">// 动画进度，取值范围 [0, 1]</span>
	spread<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>                              <span class="token comment">// 效果扩散半径，默认 3</span>
	edgeFlatness<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>                        <span class="token comment">// 边缘平缓度，默认 5</span>
	<span class="token function-variable function">styleCallback</span><span class="token operator">:</span> <span class="token punctuation">(</span>intensity<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token builtin">string</span><span class="token punctuation">;</span> <span class="token comment">// 强度到样式的转换函数</span>
	innerClassName<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>                      <span class="token comment">// 字符容器的 CSS 类名</span>
<span class="token punctuation">&#125;</span></code><!----></pre> <h3 id="实际使用示例"><a class="anchor-link" href="#实际使用示例">实际使用示例</a></h3> <pre class="language-svelte"><!----><code class="language-svelte"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TextAnimation</span>
    <span class="token attr-name">text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Hello, World!<span class="token punctuation">"</span></span>
    <span class="token language-javascript"><span class="token punctuation">&#123;</span>progress<span class="token punctuation">&#125;</span></span>
    <span class="token attr-name">spread=</span><span class="token language-javascript"><span class="token punctuation">&#123;</span><span class="token number">4</span><span class="token punctuation">&#125;</span></span>
    <span class="token attr-name">edgeFlatness=</span><span class="token language-javascript"><span class="token punctuation">&#123;</span><span class="token number">6</span><span class="token punctuation">&#125;</span></span>
    <span class="token attr-name">styleCallback=</span><span class="token language-javascript"><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token parameter">intensity</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token template-string"><span class="token template-punctuation string">&#96;</span><span class="token string">
        transform: scale(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token number">1</span> <span class="token operator">+</span> intensity <span class="token operator">*</span> <span class="token number">0.5</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">);
        color: rgb(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token number">255</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span><span class="token number">255</span> <span class="token operator">*</span> intensity<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span><span class="token number">255</span> <span class="token operator">*</span> intensity<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">);
    </span><span class="token template-punctuation string">&#96;</span></span><span class="token punctuation">&#125;</span></span>
<span class="token punctuation">/></span></span></code><!----></pre> <p>你可以在 <a href="https://svelte.dev/playground/434018293cfb415b925f19b47ef4a85c?version=5.33.1" rel="nofollow">Svelte Playground</a> 中直接体验这个组件的效果。</p> <p>实际应用场景可以参考本博客首页的 Landing 部分，对应的源码实现：<a href="https://github.com/QuarkPixel/QuarkPixel.github.io/blob/master/src/routes/Landing.svelte" rel="nofollow">Landing.svelte</a>。</p> <hr> <h2 id="总结"><a class="anchor-link" href="#总结">总结</a></h2> <p><code>svelte-text-animation</code> 通过精心设计的数学函数组合，实现了既平滑又视觉效果出色的文字动画。最新版本中边缘递减函数的优化，通过引入可调节的平缓度参数，显著提升了动画在整个进度范围内的表现效果。</p> <p>这种基于数学模型的设计方法不仅保证了动画的流畅性，还为开发者提供了充分的自定义空间。如果你对这个组件感兴趣，欢迎在 <a href="https://github.com/QuarkPixel/svelte-text-animation" rel="nofollow">GitHub</a> 上为项目点个 Star 😆</p><!----></div> <!--[--><div class="text-end text-sm font-noto-serif opacity-50">© 2025
			Xuancong Meng</div><!--]--> <div class="min-h-[372px] my-15"><!--[!--><!--]--></div><!----></article><!----><!----><!----></div></div> <footer class="py-6 text-xs sm:text-sm flex flex-col items-center gap-2 snap-end font-gravitas-one"><div class="flex gap-4 text-surface-800-200 whitespace-nowrap"><!--[--><a href="/privacy" class="hover:text-primary-700-300" target="_self">Privacy Policy</a> <!--[-->/<!--]--><a href="/feed/rss.xml" class="hover:text-secondary-700-300" target="_blank">RSS</a> <!--[-->/<!--]--><a href="https://github.com/QuarkPixel/QuarkPixel.github.io" class="hover:text-primary-700-300" target="_blank">Source Code</a> <!--[!--><!--]--><!--]--></div> <div class="text-center font-noto-serif text-surface-600-400">Powered by <a href="https://svelte.dev" target="_blank" rel="noopener noreferrer">Svelte</a> ·
		Designed by <a href="https://github.com/QuarkPixel" target="_blank" rel="noopener noreferrer">QuarkPixel</a></div></footer><!----> <div class="bg-surface-800-200 text-surface-50-950 bottom-0 z-0 overflow-hidden relative" style="height: 36px; filter: brightness(1) sepia(0);"><div class="relative" style="top: 0px;"><div class="group flex gap-[1rem] overflow-hidden font-gravitas-one motion-reduce:overflow-auto relative select-none flex-row" style="mask-image: none;
	  -webkit-mask-image: none;
	  "><!--[--><div class="flex justify-around gap-[1rem] [--gap:1rem] shrink-0 animate-marquee-left flex-row"><!----><div>All content copyright by Xuancong Meng, unless otherwise noted.</div> <div>Reproduction without permission of the original author is prohibited.</div> <div>© Xuancong Meng 2025</div><!----></div><div class="flex justify-around gap-[1rem] [--gap:1rem] shrink-0 animate-marquee-left flex-row"><!----><div>All content copyright by Xuancong Meng, unless otherwise noted.</div> <div>Reproduction without permission of the original author is prohibited.</div> <div>© Xuancong Meng 2025</div><!----></div><!--]--></div><!----></div></div><!----> <!----><!----><!--]--> <!--[!--><!--]--><!--]-->
			
			<script>
				{
					__sveltekit_wl1ign = {
						base: new URL("..", location).pathname.slice(0, -1)
					};

					const element = document.currentScript.parentElement;

					Promise.all([
						import("../_app/immutable/entry/start.CivIbf2k.js"),
						import("../_app/immutable/entry/app.BtJwDL0j.js")
					]).then(([kit, app]) => {
						kit.start(app, element, {
							node_ids: [0, 5],
							data: [null,null],
							form: null,
							error: null
						});
					});
				}
			</script>
		</div>
</body>
</html>
