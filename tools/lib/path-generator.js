import fs from 'fs';
import path from 'path';

export function generatePostsPath(projectRoot) {
	const postsDir = path.join(projectRoot, 'posts');
	const logsDir = path.join(projectRoot, 'posts', 'logs');
	const postsFiles = fs.readdirSync(postsDir).filter((file) => file.endsWith('.md'));
	const logsFiles = fs.readdirSync(logsDir).filter((file) => file.endsWith('.md'));
	let result = {
		posts: postsFiles.map((file) => file.replace('.md', '')),
		logs: logsFiles.map((file) => file.replace('.md', ''))
	};
	result.paths = [
		...result.posts.map((name) => {
			return path.join('p', name);
		}),
		...result.logs.map((name) => {
			return path.join('logs', name);
		})
	];

	const output = `// Auto-generated by posts-generator
export const posts = ${JSON.stringify(result.posts, null, 2)};
export const logs = ${JSON.stringify(result.logs, null, 2)};
export const paths = ${JSON.stringify(result.paths, null, 2)};
`;

	const outputPath = path.join(projectRoot, 'src/lib/posts.js');
	fs.writeFileSync(outputPath, output);
	console.log('âœ¨ Generated src/lib/posts.js');
}
